<div class="flex z-30 flex-col items-center justify-start w-full max-h-screen bg-[#2c2336] text-white p-2 md:p-6 relative overflow-y-auto">

 <h1 class="text-4xl font-bold mb-4 text-center">Simulador Mundial 2026</h1>
	<!-- Step 1: Team Selection -->
	<ng-container *ngIf="!loading && !showResults">
		<div class="w-full flex flex-col items-center justify-center mb-6">
			<h2 class="text-2xl font-semibold mb-2">Selecciona tu equipo para apostar</h2>
			<div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-3">
				<div
					class="bg-[#77609a] rounded-lg p-2 flex flex-col items-center cursor-pointer hover:bg-[#5e4b7b] transition border-4"
					[ngClass]="selectedTeam === team.name ? 'border-[#6805F2]' : 'border-transparent'"
					*ngFor="let team of teams"
					(click)="selectTeam(team.name)">
					<div class="w-10 h-10 mb-1 flex items-center justify-center text-2xl">{{team.flag}}</div>
					<span class="text-sm">{{team.name}}</span>
				</div>
			</div>
			<div class="mt-6 flex flex-col items-center rounded-lg p-2 text-white">
				<label class="text-lg mb-2">Â¿CuÃ¡ntos puntos quieres apostar?</label>
				<input
					type="number"
					[(ngModel)]="betAmount"
					min="1"
					placeholder="Ej. 100"
					class="bg-[#751eee] hover:bg-[#6805F2] px-4 py-2 rounded-lg text-white w-40 text-center"
				/>
			</div>
			<div class="mt-4 flex justify-center">
				<button mat-raised-button color="primary"
					class="bg-[#751eee] hover:bg-[#6805F2] text-white px-6 py-2 rounded-full text-lg shadow disabled:opacity-50"
					[disabled]="!selectedTeam"
					(click)="startSimulation()">
					Iniciar simulaciÃ³n
				</button>
			</div>
		</div>
	</ng-container>

	<!-- Step 2: Loading Overlay -->
	<ng-container *ngIf="loading">
				<div class="fixed inset-0 flex flex-col items-center justify-center bg-[#322743] bg-opacity-95 z-50">
						<div class="w-20 h-20 mb-4 flex items-center justify-center">
							<span class="block w-16 h-16 border-8 border-[#6805F2] border-t-transparent rounded-full animate-spin"></span>
						</div>
						<span class="text-2xl font-semibold">Simulando torneo...</span>
				</div>
	</ng-container>

	<!-- Step 3: Simulation Results -->
	<ng-container *ngIf="showResults && !loading">
	<div class="w-full flex flex-col items-center justify-center">
		
		<!-- Fase de grupos -->
		<div class="bg-[#302540] rounded-lg p-4 w-full">
		<h3 class="font-bold mb-2 text-xl">Fase de Grupos</h3>

		<div class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-2">
			<ng-container *ngFor="let group of groups; let i = index">
			<div class="bg-[#6e5c85] rounded-lg p-2">
				<div class="font-semibold mb-1">Grupo {{ 'A' | charCodeAt: i }}</div>
				<div *ngFor="let team of group" class="text-sm flex justify-between">
				<span>{{ team.flag }} {{ team.name }}</span>
				<span class="font-bold">{{ team.points }} pts</span>
				</div>
			</div>
			</ng-container>
		</div>
		</div>

		<h2 class="text-2xl font-semibold mt-13 mb-6">Resultados del Torneo</h2>
		<!-- Resumen general -->
		<div class="bg-[#302540] rounded-lg p-4 text-center w-full mb-4">
		<p class="text-lg font-semibold mb-2">Resumen del Torneo</p>
		<p>Total de equipos: <span class="font-bold">48</span></p>
		<p>Equipos eliminados en fase de grupos: 
			<span class="font-bold text-red-400">{{ eliminatedTeams.length }}</span>
		</p>

		<!-- ðŸ”» Listado de eliminados -->
		<div class="mt-2 text-sm text-gray-300" *ngIf="eliminatedTeams.length > 0">
			<p class="font-semibold mb-1">Equipos eliminados:</p>
			<div class="grid grid-cols-2 md:grid-cols-4 gap-1">
			<div *ngFor="let t of eliminatedTeams">
				<span>{{ t.flag }} {{ t.name }}</span>
			</div>
			</div>
		</div>
		</div>

		<!-- Eliminatorias -->
		<div class="w-full flex flex-col items-center justify-center mt-10 px-4">
		<h3 class="text-2xl font-extrabold mb-6 text-white tracking-wide uppercase">Eliminatorias</h3>

		<div
			class="flex flex-wrap justify-center gap-10 w-full overflow-x-auto py-4 border-t border-gray-700/50"
		>
			<!-- Etapas del bracket -->
			<div
			*ngFor="let round of knockoutRounds; let roundIndex = index"
			class="flex flex-col items-center bg-gradient-to-b from-[#3a2f4f] to-[#4e3d67] rounded-2xl p-4 shadow-lg border border-[#806ba1]/30 min-w-[210px]"
			>
			<div class="font-semibold text-sm uppercase text-purple-300 mb-3 tracking-wider">
				{{
				round.length === 32 ? 'Ronda de 32' :
				round.length === 16 ? 'Octavos de final' :
				round.length === 8 ? 'Cuartos de final' :
				round.length === 4 ? 'Semifinal' :
				'Final'
				}}
			</div>

			<!-- Partido -->
			<div
				*ngFor="let matchIndex of [].constructor(round.length / 2); let j = index"
				class="bg-[#7d68a6]/40 backdrop-blur-sm rounded-xl p-3 mb-3 w-52 shadow-md border border-[#9f87c5]/20 hover:bg-[#8b74b5]/50 transition-all duration-200">
				<div class="flex items-center justify-between font-medium text-sm text-gray-100">
					<span>{{ round[j*2]?.flag }} {{ round[j*2]?.name }}</span>
					<span class="text-xs text-gray-300">{{ round[j*2]?.finalPower }}</span>
					</div>
					<div class="text-center text-xs text-purple-200 mt-1 mb-1 font-semibold">vs</div>
					<div class="flex items-center justify-between font-medium text-sm text-gray-100">
					<span>{{ round[j*2+1]?.flag }} {{ round[j*2+1]?.name }}</span>
					<span class="text-xs text-gray-300">{{ round[j*2+1]?.finalPower }}</span>
					</div>
				</div>
			</div>
		</div>

		<!--CampeÃ³n-->
		<div class="flex flex-col items-center mt-10 bg-gradient-to-r from-yellow-400/20 to-yellow-200/10 p-5 rounded-xl shadow-inner border border-yellow-400/30">
			<span class="font-extrabold text-xl text-white text-center drop-shadow-sm">
			Â¡CampeÃ³n: {{ champion?.flag }} {{ champion?.name }}!
			</span>
		</div>
		</div>
			<!-- Puntos ganados -->
			<div class="w-full flex flex-col items-center bg-[#6e5c85] rounded-xl p-4 shadow mt-5 mb-4">
			<span class="text-xl font-semibold mb-2">
				{{ betResult > 0 ? 'Â¡Ganaste puntos!' : 'Perdiste tus puntos' }}
			</span>

			<div class="flex items-center gap-2" [ngClass]="betResult > 0 ? 'text-green-400' : 'text-red-400'">
				<mat-icon>{{ betResult > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
				<span class="text-3xl font-bold">
				{{ betResult > 0 ? '+' + betResult : betResult }}
				</span>
				<span class="text-lg">puntos</span>
			</div>
			<span class="text-sm text-gray-200 mt-2">
				Apostaste {{ betAmount }} puntos al equipo {{ selectedTeam }}.
			</span>
			</div>
			<button
			mat-stroked-button
			class="mt-2 border border-white px-4 py-2 rounded-full bg-[#302540] hover:bg-[#403257]"
			(click)="reset()">
			Volver a apostar
			</button>
		</div>
	</ng-container>
</div>
