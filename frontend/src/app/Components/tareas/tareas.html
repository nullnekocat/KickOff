<div class="bg-white shadow-md rounded-lg p-4 w-full">

  <div class="flex justify-between items-center mb-3">
    <h2 class="text-xl font-bold text-[#330685]">Tareas</h2>
    <div class="flex items-center gap-2">
      <button (click)="openModal()" class="text-purple-900">
        <mat-icon>add</mat-icon>
      </button>
      <button (click)="toggleShowHidden()" class="text-gray-700">
        <mat-icon>{{ showHidden ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
    </div>
  </div>

  <ul class="divide-y divide-gray-200">
    <li *ngFor="let t of tareas" class="py-3 flex justify-between items-center">

      <!-- Checkbox solo habilitado si el usuario es el asignado -->
      <input 
        type="checkbox"
        [disabled]="!isAssignedToCurrentUser(t.inChargeId._id)"
        [checked]="t.completed"
        (change)="toggleCompleted(t)"
        class="mr-3 w-5 h-5 text-[#330685] rounded"
      >

      <div class="flex flex-col flex-1">
        <p [class.line-through]="t.completed">{{ t.text }}</p>
        <small class="text-gray-500">Asignado a: {{ t.inChargeId.name }}</small>
      </div>

      <div class="flex items-center gap-2">
        <!-- Cuando estamos viendo tareas visibles: 'ocultar' -->
        <button *ngIf="!showHidden" class="text-yellow-600" (click)="hideTask(t)" title="Ocultar tarea">
          <mat-icon>visibility_off</mat-icon>
        </button>

        <!-- Cuando estamos viendo tareas ocultas: 'mostrar' y 'borrar' -->
        <button *ngIf="showHidden" class="text-green-600" (click)="unhideTask(t)" title="Mostrar tarea">
          <mat-icon>visibility</mat-icon>
        </button>

        <button *ngIf="showHidden" class="text-red-600" (click)="deleteTask(t)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

    </li>
  </ul>
</div>

<!-- MODAL -->
<div *ngIf="showModal" class="fixed inset-0 bg-black/50 flex items-center justify-center">
  <div class="bg-white p-5 rounded shadow w-80">

    <h3 class="text-lg font-bold mb-3">Nueva tarea</h3>

    <input type="text" [(ngModel)]="newText"
      placeholder="DescripciÃ³n" class="w-full mb-3 px-3 py-2 border rounded">

    <select [(ngModel)]="selectedUser" class="w-full mb-4 px-3 py-2 border rounded">
      <option value="">Asignar a...</option>
      <option *ngFor="let m of members" [value]="m._id">{{ m.name }}</option>
    </select>

    <div class="flex justify-end gap-2">
      <button (click)="showModal=false" class="px-3 py-2 bg-gray-300 rounded">Cancelar</button>
      <button (click)="createTask()" class="px-3 py-2 bg-purple-700 text-white rounded">Crear</button>
    </div>

  </div>
</div>
