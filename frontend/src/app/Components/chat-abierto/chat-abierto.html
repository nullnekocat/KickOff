<div class="flex flex-col max-h-svh h-screen w-full bg-[#2C2336]"> <!-- altura completa y ancho completo -->

  <div class="flex justify-between items-center p-4 bg-[#1e1725] text-white flex-shrink-0 w-full">
    <div class="flex items-center gap-3">
      <div class="w-14 h-14 rounded-full bg-[#e63167] flex items-center justify-center font-bold text-lg">
        {{ selectedChat?.name ? (selectedChat?.name | slice:0:2) : '???' }}
      </div>
      <div class="flex flex-col">
        <h2 class="text-sm sm:text-base font-semibold">
          {{ selectedChat?.name || 'Unknown chat' }}
        </h2>
        <span class="text-xs sm:text-sm text-gray-300">
          {{ selectedChat?.status === 1 ? 'En línea' : (selectedChat ? 'Desconectado' : 'Selecciona un chat') }}
        </span>
      </div>
    </div>
    <div class="flex gap-2"> 
      <button class="text-gray-300 hover:text-white" (click)="abrirLlamadaVozModal()"><mat-icon>phone</mat-icon></button>
      <button class="text-gray-300 hover:text-white" (click)="abrirLlamada()"><mat-icon>videocam</mat-icon></button>
      <button class="text-gray-300 hover:text-white"><mat-icon>lock</mat-icon></button>
    </div>
  </div>

  <!-- mensajes -->
  <div class="flex-1 overflow-y-auto p-4 flex flex-col gap-2 bg-[#2C2336] w-full">
    <div *ngFor="let msg of messages" 
        [ngClass]="msg.sender === 'me' ? 'self-end bg-[#3d2563]' : 'self-start bg-[#5b3f87]'"
        class="text-white p-3 rounded-xl max-w-[75%]">
      <div class="font-semibold text-sm mb-1">{{ msg.senderName }}</div>
      <div>{{ msg.text }}</div>
      <div class="text-xs text-gray-200 mt-1 text-right">{{ msg.time }}</div>
    </div>
  </div>

  <!-- barra baja -->
  <div class="flex items-center p-3 bg-[#1e1725] gap-2 flex-shrink-0 w-full">
    <input type="text" [(ngModel)]= "inputMessage" placeholder="Escribe un mensaje..." 
          class="flex-1 rounded-full px-4 py-2 bg-[#59496b] text-white focus:outline-none"
          (keydown.enter)="sendMessage()">

    <label for="fileInput" class="bg-[#501F9D] w-10 h-10 rounded-full flex items-center justify-center text-white cursor-pointer hover:bg-[#5a28c8]">
      <mat-icon>attach_file</mat-icon>
    </label>
    <!--input type="file" id="fileInput" class="hidden" (change)="sendFile($event)"-->

    <button class="bg-[#501F9D] w-10 h-10 rounded-full flex items-center justify-center text-white hover:bg-[#5a28c8]" 
            (click)="sendMessage()">
      <mat-icon>send</mat-icon>
    </button>
  </div>

</div>


<!-- modal llamada de voz -->
<div *ngIf="abrirLlamadaVoz"
    class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl shadow-lg w-[24rem] max-w-full text-center relative">
    
    <div class="flex flex-col items-center mb-6">
      <div class="w-24 h-24 rounded-full bg-[#e63167] flex items-center justify-center text-white text-3xl font-bold">
        JP
      </div>
      <h2 class="text-lg font-semibold mt-4 text-[#330685]">Juan Pérez</h2>
      <p class="text-sm text-gray-500">Llamada entrante...</p>
    </div>

    <div class="flex justify-center gap-6">
      <button class="bg-red-500 hover:bg-red-600 text-white py-3 px-6 rounded-full flex items-center gap-2"
              (click)="cerrarLlamadaVoz()">
        <mat-icon>call_end</mat-icon>
        Rechazar
      </button>
      <button class="bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-full flex items-center gap-2"
              (click)="iniciarLlamadaVoz()">
        <mat-icon>call</mat-icon>
        Aceptar
      </button>
    </div>

    <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
            (click)="cerrarLlamadaVoz()">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>

<!-- modal videollamada -->
<div *ngIf="abrirVideollamada"
  class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl shadow-lg w-[32rem] max-w-full text-center relative">
    
    <h2 class="text-lg font-semibold mb-4 text-[#330685]">Videollamada</h2>

    <div class="bg-black rounded-xl h-64 flex items-center justify-center mb-6">
      <p class="text-white">Vista previa de la llamada</p>
    </div>

    <div class="flex justify-center gap-6">
      <button class="bg-red-500 hover:bg-red-600 text-white py-2 px-6 rounded-full flex items-center gap-2"
              (click)="cerrarLlamada()">
        <mat-icon>call_end</mat-icon>
        Rechazar
      </button>

      <button class="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-full flex items-center gap-2"
              (click)="iniciarLlamada()">
        <mat-icon>call</mat-icon>
        Aceptar
      </button>
    </div>

    <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
            (click)="cerrarLlamada()">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>
